/* DO NOT EDIT THIS FILE! It is automatically generated by Grunt. */
(function() {
    'use strict';

    app.View.NoteList = Marionette.CompositeView.extend({

        el: '#notes-wrapper',
        template: '#tmpl_note_list',

        childView: app.View.Note,
        childViewContainer: 'div',

        initialize: function() {
            this.render();
        },

        onRender: function() {
            this.$el.find('> div').addClass('masonry-wrapper');
        },

        collectionEvents: {
            'add': 'updateLayout',
            'remove': 'updateLayout',
            'fetch': 'afterFetch'
        },

        afterFetch: function() {
            $('.masonry-wrapper').masonry({
                columnWidth: 0,
                itemSelector: '.note'
            });

            window.masonry = $('.masonry-wrapper').data('masonry');
        },

        events: {
            'click .new': 'new'
        },

        updateLayout: function() {
            if (window.masonry) {
                window.masonry.reloadItems();
                window.masonry.layout();
            }
        },

        new: function() {
            this.collection.add({
                title: '',
                content: '',
                createdDate: new Date().getTime(),
                isEditing: false,
                isArchived: false
            });
        }

    });

})();

(function() {
    'use strict';

    app.View.Note = Marionette.ItemView.extend({

        tagName: 'div',
        template: '#tmpl_note',

        initialize: function() {
            var self = this;
            this.on('render', function() {
                window.setTimeout(function() {
                    self.afterRender();
                }, 1);
            });
        },

        afterRender: function() {
            var self = this;
            this.$el.find('textarea').autosize({
                append: '',
                callback: this.updateLayout
            }).on('input', function() {
                waitForFinalEvent(function() {
                    self.save();
                }, 100, 'input');
            });
        },

        onRender: function() {
            this.$el.addClass('note');
        },

        events: {
            'click .delete': 'delete'
        },

        updateLayout: function() {
            if (window.masonry) {
                window.masonry.reloadItems();
                window.masonry.layout();
            }
        },

        save: function() {
            var title = this.$('.title').val() || '...',
                content = this.$('.content').val() || '...';

            this.model.save({
                title: title,
                content: content,
                isEditing: false
            });
        },

        delete: function() {
            this.model.destroy();
        }

    });

})();
